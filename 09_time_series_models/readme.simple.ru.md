# Временные ряды: как предсказывать будущее по прошлому

## Что такое временной ряд?

Представь, что ты каждый день записываешь свой рост. Сначала ты был маленький, потом становился всё выше и выше. Если сложить все эти записи по порядку — получится **временной ряд**!

Временной ряд — это просто список чисел, записанных по порядку во времени:
- Температура на улице каждый час
- Твои оценки за каждую контрольную
- Цена яблок в магазине каждую неделю
- Количество лайков под твоим видео каждый день

В мире финансов трейдеры смотрят на цены акций, записанные каждый день (или даже каждую секунду!), и пытаются угадать, куда цена пойдёт дальше.

---

## Как найти закономерности?

### Тренд — общее направление

**Пример из жизни:** Представь, что ты отслеживаешь рост щенка. Каждый месяц он становится немного больше. Иногда он болеет и худеет, но в целом растёт вверх. Это и есть **тренд** — общее направление движения.

- Цены на жильё обычно растут годами — это **восходящий тренд**
- Заряд батарейки в телефоне падает — это **нисходящий тренд**

### Сезонность — повторяющиеся циклы

**Пример из жизни:** Мороженое продаётся лучше летом, а шоколадки — зимой перед Новым годом. Каждый год это повторяется!

- Продажи ёлочных игрушек взлетают в декабре
- Температура на улице выше летом, ниже зимой
- Продажи школьных товаров растут в августе-сентябре

### Шум — случайные колебания

**Пример из жизни:** Ты бросаешь мяч в корзину. Иногда попадаешь, иногда нет — это случайность. В данных тоже есть такие случайные скачки, которые ничего не значат.

---

## Стационарность — когда всё стабильно

### Что это такое?

**Простой пример:** Представь две реки:
- **Горная река** — то быстрая, то медленная, уровень воды постоянно прыгает от дождей и таяния снега
- **Канал в парке** — вода течёт ровно, уровень примерно одинаковый каждый день

Канал — это **стационарный** ряд. В нём среднее значение и размах колебаний не меняются со временем.

### Почему это важно?

Предсказывать легче то, что ведёт себя стабильно! Если река каждый день разная, угадать её уровень завтра сложно. А если канал всегда примерно на одном уровне — легко!

### Как сделать ряд стационарным?

**Пример:** Допустим, у тебя есть данные о твоей коллекции карточек:
- Январь: 10 карточек
- Февраль: 15 карточек
- Март: 22 карточки
- Апрель: 25 карточек

Это **нестационарный** ряд — коллекция растёт!

Но если посмотреть, **сколько карточек ты получил за месяц**:
- Январь → Февраль: +5
- Февраль → Март: +7
- Март → Апрель: +3

Эти прибавки уже более стабильны — это **стационарный** ряд. Такое преобразование называется **дифференцирование**.

---

## Автокорреляция — связь с прошлым

### Что это?

**Пример:** Если сегодня на улице жарко, скорее всего, завтра тоже будет жарко. Погода сегодня *связана* с погодой вчера.

**Автокорреляция** — это когда текущее значение связано с предыдущими значениями того же ряда.

**Ещё пример:** Если ты получил «5» на контрольной по математике, скорее всего, ты хорошо готовился. И на следующей контрольной тоже получишь хорошую оценку. Твои оценки связаны между собой!

### ACF и PACF — инструменты измерения

Это как линейки, которые измеряют, насколько сильно связаны значения:
- **ACF** — измеряет общую связь
- **PACF** — измеряет прямую связь (без влияния промежуточных значений)

---

## Модели для предсказаний

### AR (Авторегрессия) — предсказание по прошлым значениям

**Аналогия:** Ты пытаешься угадать, сколько конфет съешь сегодня. Смотришь на то, сколько съел вчера, позавчера, три дня назад... и на основе этого делаешь прогноз!

Формула проста: **Будущее = Прошлое × какие-то числа + случайность**

**Пример:** Если каждый день ты съедаешь примерно столько же конфет, сколько вчера (минус одна), то:
- Понедельник: 10 конфет
- Вторник: ~9 конфет
- Среда: ~8 конфет

### MA (Скользящее среднее) — предсказание по прошлым ошибкам

**Аналогия:** Ты учишься играть в дартс. Каждый раз ты смотришь, куда промахнулся в прошлый раз, и корректируешь бросок.

Модель MA смотрит не на сами значения, а на **ошибки прогноза** — насколько мы промахнулись в прошлый раз.

### ARIMA — комбинация всего!

**ARIMA** = AR + I + MA

Это как супергерой, который умеет всё:
- **AR** — смотрит на прошлые значения
- **I** (Integration) — делает ряд стационарным
- **MA** — учитывает прошлые ошибки

---

## Волатильность — когда штормит!

### Что это?

**Пример:** Представь два аттракциона:
- **Колесо обозрения** — плавно крутится, скорость почти не меняется
- **Американские горки** — то вверх, то вниз, то быстро, то медленно!

Американские горки — это **высокая волатильность** (большие скачки), а колесо обозрения — **низкая волатильность** (всё спокойно).

### Кластеризация волатильности

**Интересный факт:** Когда на рынке начинается «шторм», он обычно продолжается какое-то время. Если сегодня цены прыгали туда-сюда, завтра скорее всего тоже будет нестабильно.

**Аналогия:** Когда начинается гроза, она не заканчивается за минуту — грохочет какое-то время.

### GARCH — модель для предсказания волатильности

Эта модель говорит: «Если вчера было штормит, сегодня тоже, скорее всего, будет штормить!»

---

## VAR — когда несколько рядов вместе

### Что это?

**Пример:** Представь, что ты изучаешь:
- Сколько часов ты спишь
- Сколько получаешь оценок «5»
- Сколько съедаешь на завтрак

Все эти вещи **связаны**! Если ты хорошо спишь — лучше учишься. Если хорошо ешь — лучше спишь.

**VAR** (Vector AutoRegression) — это модель, которая смотрит на несколько рядов одновременно и учитывает, как они влияют друг на друга.

---

## Коинтеграция — вместе навсегда!

### Что это?

**Классический пример — пьяница и его собака:**

Представь пьяного человека, который гуляет с собакой на поводке:
- **Пьяница** идёт зигзагами — случайно влево, случайно вправо
- **Собака** тоже бегает случайно — то к кустам, то к столбу

Каждый по отдельности двигается **случайно** (как цены акций). НО! Они связаны поводком, поэтому не могут уйти далеко друг от друга.

Это и есть **коинтеграция** — два ряда, каждый из которых сам по себе непредсказуем, но разница между ними остаётся стабильной!

### Другие примеры из жизни:

- **Цена бензина и цена нефти** — когда нефть дорожает, бензин тоже. Они двигаются вместе!
- **Акции Coca-Cola и Pepsi** — две похожие компании, их цены часто двигаются синхронно
- **Твои карманные деньги и траты** — если получаешь больше, тратишь больше

---

## Парная торговля — как заработать на «поводке»

### Идея стратегии

Помнишь пьяницу с собакой? Теперь представь, что ты можешь на этом заработать!

**Стратегия:**
1. Найди две акции, которые «на поводке» (коинтегрированы)
2. Когда одна ушла слишком далеко вверх, а другая слишком далеко вниз — продай дорогую, купи дешёвую
3. Подожди, пока они вернутся друг к другу
4. Закрой сделки и получи прибыль!

### Пример из жизни:

Представь, что обычно яблоки и груши в магазине стоят примерно одинаково (по 100 рублей). Вдруг:
- Яблоки подорожали до 150 рублей
- Груши упали до 80 рублей

Ты думаешь: «Странно! Обычно они стоят одинаково. Скорее всего, скоро цены выровняются».

Если ты трейдер:
- Продаёшь яблоки (пока дорогие)
- Покупаешь груши (пока дешёвые)
- Ждёшь, пока цены сравняются
- Зарабатываешь на разнице!

### Как найти такие пары?

1. **Корреляция** — проверь, двигаются ли цены похоже (быстрый способ)
2. **Тест на коинтеграцию** — проверь, есть ли «поводок» (надёжный способ)

---

## Итого: чему мы научились?

| Концепция | Простое объяснение | Пример из жизни |
|-----------|-------------------|-----------------|
| **Временной ряд** | Числа по порядку во времени | Твои оценки за год |
| **Тренд** | Общее направление | Рост щенка |
| **Сезонность** | Повторяющиеся циклы | Продажи мороженого летом |
| **Стационарность** | Стабильное поведение | Спокойный канал vs горная река |
| **Автокорреляция** | Связь с прошлым | Погода сегодня похожа на вчера |
| **AR модель** | Предсказание по прошлым значениям | Сколько конфет съем сегодня? |
| **MA модель** | Учёт прошлых ошибок | Корректировка броска в дартс |
| **ARIMA** | AR + стационарность + MA | Супергерой прогнозов |
| **Волатильность** | Размах колебаний | Американские горки vs колесо |
| **GARCH** | Предсказание штормов | Гроза продолжается |
| **VAR** | Несколько рядов вместе | Сон → Оценки → Еда |
| **Коинтеграция** | Два ряда «на поводке» | Пьяница и его собака |
| **Парная торговля** | Заработок на «поводке» | Яблоки и груши |

---

## Зачем это нужно?

Эти методы используются, чтобы:

1. **Предсказывать цены акций** — хотя это очень сложно!
2. **Понимать экономику** — как одни показатели влияют на другие
3. **Управлять рисками** — знать, когда может быть «шторм»
4. **Находить возможности** — как в парной торговле
5. **Автоматизировать торговлю** — роботы используют эти модели

---

## Что дальше?

В этой главе мы изучаем:

| Ноутбук | Что изучаем |
|---------|-------------|
| [01_tsa_and_stationarity](01_tsa_and_stationarity.ipynb) | Анализ рядов, стационарность |
| [02_arima_models](02_arima_models.ipynb) | Модели ARIMA |
| [03_arch_garch_models](03_arch_garch_models.ipynb) | Прогноз волатильности |
| [04_vector_autoregressive_model](04_vector_autoregressive_model.ipynb) | Модель VAR |
| [05_cointegration_tests](05_cointegration_tests.ipynb) | Тесты на коинтеграцию |
| [06_statistical_arbitrage_with_cointegrated_pairs](06_statistical_arbitrage_with_cointegrated_pairs.ipynb) | Парная торговля |
| [07_pairs_trading_backtest](07_pairs_trading_backtest.ipynb) | Тестирование стратегии |

---

*Помни: даже самые сложные вещи можно понять, если разобрать их по кусочкам!*
