# Temporal Fusion Transformers: Объяснение для школьника

## Что такое TFT?

Представь, что ты собираешься в школу и хочешь угадать, какая будет погода через неделю. Что тебе поможет?

**Информация из прошлого:**
- Какая погода была вчера, позавчера
- Шёл ли дождь на прошлой неделе

**Информация о будущем (которую ты знаешь заранее):**
- Какой будет день недели
- Какое будет число (может, это начало лета?)
- Будет ли выходной

**Постоянная информация:**
- В каком городе ты живёшь (Москва? Сочи?)
- Какое время года

**TFT (Temporal Fusion Transformer)** — это умный робот, который умеет учитывать ВСЕ эти виды информации одновременно, чтобы делать точные прогнозы!

---

## Примеры из жизни

### Пример 1: Угадываем, сколько мороженого купят

Представь, что у тебя киоск с мороженым, и ты хочешь знать, сколько мороженого заказать на следующую неделю.

```
ЧТО ТЫ ЗНАЕШЬ:

Прошлое (уже случилось):
├── Вчера продали 50 штук
├── Позавчера — 45 штук
├── На прошлой неделе в среду — 60 штук
└── Температура была 25°C

Будущее (знаешь заранее):
├── Завтра будет суббота (выходной!)
├── Послезавтра — воскресенье
├── Прогноз погоды: +30°C
└── Будет праздник (День защиты детей)

Постоянное (не меняется):
├── Киоск находится у парка
├── Рядом детская площадка
└── Работаем с 10:00 до 20:00
```

**TFT смотрит на всё это и думает:**
- "В прошлом в жару продавали много..."
- "Выходные + жара + праздник = ОЧЕНЬ много людей!"
- "Около парка всегда есть дети..."

**Прогноз TFT:** "Закажи 150 штук мороженого! И вот почему: выходной (×1.5) + жара (×1.3) + праздник (×1.4) = много покупателей"

### Пример 2: Предсказываем оценку за контрольную

```
ЧТО ЗНАЕТ TFT О ТЕБЕ:

Прошлое:
├── Последние оценки: 4, 5, 4, 3, 5
├── Сколько времени готовился
└── Были ли ошибки по темам

Будущее (известно):
├── Контрольная в понедельник
├── Тема: дроби
└── Учитель: строгий

Постоянное:
├── Ты хорошо понимаешь математику
├── Утром соображаешь лучше
└── Любишь задачи с картинками
```

**TFT предсказывает:** "Скорее всего, получишь 4 или 5"

И самое крутое — TFT объясняет ПОЧЕМУ:
- "Последние оценки хорошие (важность: 40%)"
- "Тема дроби — ты их понимаешь (важность: 35%)"
- "Понедельник утром — хорошее время (важность: 15%)"
- "Строгий учитель — может снизить на балл (важность: 10%)"

---

## Три типа информации (как в RPG игре)

### 1. Статические характеристики (не меняются)

Как в игре у персонажа есть постоянные характеристики:

```
┌──────────────────────────┐
│     КАРТОЧКА АКТИВА      │
├──────────────────────────┤
│ Имя: Bitcoin (BTC)       │
│ Класс: Криптовалюта      │
│ Тип: Layer 1             │
│ Год создания: 2009       │
│ Максимум монет: 21 млн   │
└──────────────────────────┘
```

Эта информация помогает TFT понять: "А, это Bitcoin! Он обычно ведёт себя как лидер рынка"

### 2. Известное будущее (знаем заранее)

Как расписание уроков — ты знаешь его заранее:

```
┌──────────────────────────┐
│    КАЛЕНДАРЬ СОБЫТИЙ     │
├──────────────────────────┤
│ Пн: Обычный день         │
│ Вт: Обычный день         │
│ Ср: Экспирация опционов! │
│ Чт: Отчёт ФРС            │
│ Пт: Выходной в США       │
│ Сб: Выходной             │
│ Вс: Выходной             │
└──────────────────────────┘
```

TFT думает: "В среду будет экспирация — обычно рынок волнуется!"

### 3. Наблюдаемое прошлое (только история)

Как дневник погоды — записываем каждый день:

```
┌──────────────────────────┐
│     ДНЕВНИК BITCOIN      │
├──────────────────────────┤
│ Вчера: $45,000, +2%      │
│ Позавчера: $44,100, +1%  │
│ 3 дня назад: $43,700, -1%│
│ 4 дня назад: $44,100, +3%│
│ ...                      │
└──────────────────────────┘
```

---

## Как TFT "думает"? (Механизм внимания)

### Внимание — как прожектор

Представь, что ты читаешь задачу по математике:

> "В магазине было 50 яблок. Утром продали 12 яблок. После обеда привезли ещё 20 яблок. **Сколько яблок стало?**"

Твоё внимание автоматически выделяет важные слова:
- **50** — начальное количество
- **12** — продали (минус)
- **20** — привезли (плюс)

TFT делает то же самое с данными! Он "подсвечивает" важные моменты в истории:

```
История цены Bitcoin:
                        ↓ "Это важно!"
День 1: $40,000   |
День 2: $40,500   |
День 3: $45,000   | ← TFT: "Тут был большой рост, запомню!"
День 4: $44,500   |
День 5: $44,800   |
                        ↓ "И это тоже!"
День 6: $50,000   | ← TFT: "Ещё один прыжок, важно!"
День 7: $49,500   |
```

### Выбор признаков — как выбор одежды

Утром ты выбираешь, что надеть. Что важно?

- Если **холодно** → куртка важна, шорты не важны
- Если **дождь** → зонт важен, солнечные очки не важны
- Если **праздник** → красивая одежда важна

TFT так же выбирает, какие данные важны для прогноза:

```
Для прогноза цены Bitcoin:

Волатильность рынка ВЫСОКАЯ:
├── Цена: ████████████ (очень важно)
├── Объём торгов: ████████ (важно)
├── RSI индикатор: ██████ (средне важно)
├── День недели: ██ (не очень важно)
└── Час дня: █ (почти не важно)

Волатильность рынка НИЗКАЯ:
├── Цена: ██████ (средне важно)
├── Объём торгов: ████████████ (очень важно!)
├── RSI индикатор: ████████ (важно)
├── День недели: ██████ (важнее чем обычно)
└── Час дня: ████ (тоже важнее)
```

---

## Quantile Forecasts — прогнозы с "возможно"

### Обычный прогноз (точка)

```
Обычная модель: "Bitcoin будет стоить $50,000"

Проблема: А если не $50,000? Что тогда делать?
```

### TFT прогноз (диапазон)

```
TFT говорит:
├── Пессимистично (10%): $45,000 — "вряд ли будет меньше"
├── Скорее всего (50%): $50,000 — "наиболее вероятно"
└── Оптимистично (90%): $55,000 — "вряд ли будет больше"

Это как в прогнозе погоды:
"Завтра будет 20-25 градусов, скорее всего 22"
```

### Пример: Планирование поездки

Ты едешь к бабушке и хочешь знать, когда приедешь:

```
Обычный GPS: "Приедете в 15:00"

Умный GPS (как TFT):
├── Если повезёт (10%): 14:30 — "мало машин"
├── Скорее всего (50%): 15:00 — "обычный трафик"
└── Если не повезёт (90%): 16:00 — "пробки"

Теперь ты можешь ПЛАНИРОВАТЬ:
- Если важная встреча → выезжай пораньше!
- Если не срочно → можно не торопиться
```

---

## Зачем это нужно в трейдинге?

### Проблема трейдера

У трейдера есть 100,000 рублей. Что делать?

```
Вариант 1: Купить Bitcoin
├── Может вырасти на 20%! (+20,000)
└── Может упасть на 15%... (-15,000)

Вариант 2: Купить Ethereum
├── Может вырасти на 30%! (+30,000)
└── Может упасть на 25%... (-25,000)

Вариант 3: Оставить в кэше
├── Не потеряешь ничего
└── Но и не заработаешь
```

### Как помогает TFT

```
TFT анализирует Bitcoin:
┌────────────────────────────────────────┐
│ Прогноз на неделю:                     │
│ • Пессимистично: -5%                   │
│ • Скорее всего: +8%                    │
│ • Оптимистично: +15%                   │
│                                        │
│ Ширина диапазона: 20%                  │
│ Уверенность: СРЕДНЯЯ                   │
│                                        │
│ Важные факторы:                        │
│ 1. Рост объёмов (30% влияния)          │
│ 2. RSI не перекуплен (25%)             │
│ 3. Скоро экспирация опционов (20%)     │
│ 4. Позитивные новости (15%)            │
│ 5. Выходные впереди (10%)              │
└────────────────────────────────────────┘

TFT анализирует Ethereum:
┌────────────────────────────────────────┐
│ Прогноз на неделю:                     │
│ • Пессимистично: -15%                  │
│ • Скорее всего: +5%                    │
│ • Оптимистично: +25%                   │
│                                        │
│ Ширина диапазона: 40%                  │
│ Уверенность: НИЗКАЯ                    │
└────────────────────────────────────────┘
```

**Решение трейдера:**
- Bitcoin: узкий диапазон + положительный прогноз = ПОКУПАЕМ 70%
- Ethereum: широкий диапазон = СЛИШКОМ РИСКОВАННО, только 20%
- Кэш: оставим 10% на всякий случай

---

## Архитектура TFT (для любопытных)

### Как устроен TFT — пример с командой футболистов

```
┌─────────────────────────────────────────────────────────┐
│                    КОМАНДА TFT                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │
│  │   ВРАТАРЬ    │  │  ЗАЩИТНИКИ   │  │ НАПАДАЮЩИЕ   │  │
│  │ (статические │  │  (известное  │  │(наблюдаемое  │  │
│  │   данные)    │  │   будущее)   │  │   прошлое)   │  │
│  └──────┬───────┘  └──────┬───────┘  └──────┬───────┘  │
│         │                 │                  │          │
│         └────────────┬────┴──────────────────┘          │
│                      ▼                                  │
│  ┌─────────────────────────────────────────────────┐   │
│  │              ТРЕНЕР (Variable Selection)         │   │
│  │         "Кто сегодня будет играть?"              │   │
│  │    Выбирает, какие данные важны для матча        │   │
│  └───────────────────────┬─────────────────────────┘   │
│                          ▼                              │
│  ┌─────────────────────────────────────────────────┐   │
│  │              КАПИТАН (LSTM)                      │   │
│  │         Помнит всю историю команды               │   │
│  │    "В прошлый раз так играли — выиграли!"        │   │
│  └───────────────────────┬─────────────────────────┘   │
│                          ▼                              │
│  ┌─────────────────────────────────────────────────┐   │
│  │            СТРАТЕГ (Attention)                   │   │
│  │      "Смотри на ключевые моменты игры!"          │   │
│  │    Подсвечивает важные события в истории         │   │
│  └───────────────────────┬─────────────────────────┘   │
│                          ▼                              │
│  ┌─────────────────────────────────────────────────┐   │
│  │          КОММЕНТАТОР (Quantile Output)           │   │
│  │       "Скорее всего выиграем 2:1,                │   │
│  │        но может быть от 1:1 до 3:0"              │   │
│  └─────────────────────────────────────────────────┘   │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

### Пошаговый пример работы TFT

```
ЗАДАЧА: Предсказать цену Bitcoin через 24 часа

ШАГ 1: Сбор данных
├── Статические: Bitcoin, криптовалюта, 2009 год
├── Известное будущее: завтра вторник, 14:00
└── Прошлое: цены за последние 7 дней, объёмы, RSI

ШАГ 2: Выбор признаков (Variable Selection)
├── "Цена важна на 30%"
├── "Объём важен на 25%"
├── "RSI важен на 20%"
├── "День недели важен на 15%"
└── "Тип актива важен на 10%"

ШАГ 3: Запоминание истории (LSTM)
├── "3 дня назад был рост"
├── "Потом небольшое падение"
└── "Сейчас стабильно"

ШАГ 4: Выделение важного (Attention)
├── "День 3 был важным — большой объём!"
└── "День 6 тоже — разворот тренда"

ШАГ 5: Прогноз (Quantile Output)
├── 10% квантиль: $44,000
├── 50% квантиль: $46,000
└── 90% квантиль: $48,500
```

---

## Итоговая шпаргалка

| Концепция | Объяснение для ребенка |
|-----------|------------------------|
| **TFT** | Умный робот, который смотрит на разные виды информации и делает прогнозы |
| **Static** | Постоянные характеристики (как имя и возраст) |
| **Known Future** | То, что знаешь заранее (как расписание) |
| **Observed** | История событий (как дневник) |
| **Variable Selection** | Выбор важного (как выбор одежды по погоде) |
| **Attention** | Прожектор на важные моменты в истории |
| **LSTM** | Память о прошлых событиях |
| **Quantile** | Прогноз "от и до" (не точка, а диапазон) |
| **GRN** | Фильтр, который пропускает только важное |

---

## Практика: Rust примеры

В этой папке есть примеры на Rust для работы с криптовалютами:

```
rust_tft_trading/
├── src/
│   ├── lib.rs              # Главный модуль
│   ├── api/                # Получение данных с Bybit
│   │   ├── client.rs       # Клиент API
│   │   └── types.rs        # Типы данных
│   ├── data/               # Обработка данных
│   │   ├── loader.rs       # Загрузка
│   │   ├── features.rs     # Расчёт признаков
│   │   └── dataset.rs      # Подготовка данных
│   ├── model/              # Модель TFT
│   │   ├── grn.rs          # Gated Residual Network
│   │   ├── vsn.rs          # Variable Selection
│   │   ├── attention.rs    # Механизм внимания
│   │   └── tft.rs          # Полная модель
│   └── strategy/           # Торговля
│       ├── signals.rs      # Сигналы покупки/продажи
│       └── backtest.rs     # Проверка на истории
├── examples/
│   ├── fetch_data.rs       # Загрузка данных
│   ├── train_model.rs      # Обучение
│   └── predict.rs          # Прогнозирование
└── data/                   # Папка для данных
```

### Как запустить:

```bash
# 1. Скачать данные с биржи Bybit
cargo run --example fetch_data

# 2. Обучить модель TFT
cargo run --example train_model

# 3. Сделать прогноз
cargo run --example predict

# 4. Проверить стратегию на истории
cargo run --example backtest
```

---

## Вопросы для самопроверки

1. **Какие три типа данных использует TFT?**
   - Статические, известные будущие, наблюдаемые прошлые

2. **Зачем нужен механизм внимания (Attention)?**
   - Чтобы выделить важные моменты в истории

3. **Что такое quantile forecast?**
   - Прогноз не одной точки, а диапазона "от и до"

4. **Почему TFT лучше обычных моделей?**
   - Потому что он понимает разные типы данных и объясняет свои прогнозы

5. **Как Variable Selection помогает?**
   - Автоматически выбирает, какие признаки важны для прогноза

---

*Автор: Claude AI*
*Глава 26: Temporal Fusion Transformers*
