# Внутридневные данные AlgoSeek - Просто и понятно

## Что это вообще такое?

Представь, что ты смотришь видео биржевых торгов, но вместо того, чтобы смотреть его постоянно, ты делаешь скриншот каждую минуту. Каждый такой "скриншот" содержит 54 разных показателя о том, что происходило с акцией за эту минуту. Это и есть минутные бары AlgoSeek!

### Простая аналогия

**Минутный бар = Спортивная статистика за один период игры**

Как после каждого периода хоккейного матча показывают статистику (броски, голы, владение шайбой), так и минутный бар показывает статистику торгов за минуту.

## Два типа данных: Котировки (Q) и Сделки (T)

### Котировки (Quotes) - это объявления о намерениях

**Аналогия:** Базар с объявлениями
- "Куплю iPhone за 50,000₽!" - это Bid (предложение купить)
- "Продам iPhone за 55,000₽!" - это Ask (предложение продать)
- Разница 5,000₽ - это спред

**В данных AlgoSeek:**
- `OpenBidPrice` = 100.50$ - кто-то готов купить за эту цену
- `OpenAskPrice` = 100.52$ - кто-то готов продать за эту цену
- Спред = 0.02$ = 2 цента

### Сделки (Trades) - это реальные покупки

**Аналогия:** Кассовый чек
Когда покупатель и продавец договорились - произошла сделка. Записывается:
- Время сделки
- Цена сделки
- Количество акций

## Разбор ключевых полей (из 54)

### 1. Базовая информация (поля 1-3)

```python
# Пример данных
Date = 20170315          # 15 марта 2017
Ticker = "AAPL    "      # Apple (дополнено пробелами до 8 символов)
TimeBarStart = 1030      # Бар от 10:30 до 10:31
```

**Просто:** Какая акция, какой день, какая минута.

### 2. Открытие минуты (поля 4-8) - Котировки

```python
OpenBarTime = 103000000      # 10:30:00.000
OpenBidPrice = 139.50        # Лучшая цена покупки: $139.50
OpenBidSize = 500            # Хотят купить 500 акций
OpenAskPrice = 139.52        # Лучшая цена продажи: $139.52
OpenAskSize = 300            # Хотят продать 300 акций
```

**Простая картинка начала минуты:**
```
ПОКУПАТЕЛИ                    ПРОДАВЦЫ
500 акций → $139.50    $139.52 ← 300 акций
           (спред = $0.02)
```

### 3. Первая сделка (поля 9-11) - Реальная покупка

```python
FirstTradeTime = 103005123   # 10:30:05.123 (5 секунд после начала)
FirstTradePrice = 139.51     # Цена сделки (между bid и ask!)
FirstTradeSize = 100         # Куплено 100 акций
```

**Что произошло:** Через 5 секунд после начала минуты кто-то купил 100 акций Apple по $139.51 (прямо посередине между покупателем и продавцом).

### 4. Максимум и минимум (поля 12-27)

**Аналогия:** Погода за день
- Максимальная температура: +25°C в 15:00
- Минимальная температура: +10°C в 06:00

**В торгах:**
```python
HighBidTime = 103032456      # В 10:30:32 был пик
HighBidPrice = 139.55        # Максимальная цена покупки
LowBidPrice = 139.48         # Минимальная цена покупки
```

### 5. Закрытие минуты (поля 28-32)

```python
CloseBarTime = 103059999     # 10:30:59.999 (последняя миллисекунда)
CloseBidPrice = 139.52       # Финальная цена покупки
CloseAskPrice = 139.54       # Финальная цена продажи
```

### 6. Спред (поля 36-37) - Важно!

```python
MinSpread = 0.01             # Минимальная разница bid-ask = 1 цент
MaxSpread = 0.05             # Максимальная разница = 5 центов
```

**Почему это важно:**
- Маленький спред (0.01$) = легко купить/продать, много участников
- Большой спред (0.50$) = сложно торговать, мало ликвидности

**Реальный пример:**
- Apple (AAPL): спред обычно 1-2 цента - очень ликвидная акция
- Какая-нибудь маленькая компания: спред может быть 50 центов - сложно торговать

### 7. VWAP - Средневзвешенная цена (поле 39)

```python
VolumeWeightPrice = 139.515  # Средняя цена с учетом объемов
```

**Формула простыми словами:**
```
Сделка 1: 100 акций × $139.50 = $13,950
Сделка 2: 200 акций × $139.52 = $27,904
Сделка 3: 100 акций × $139.51 = $13,951
────────────────────────────────────────
Всего: 400 акций на сумму $55,805
VWAP = $55,805 / 400 = $139.51
```

**Зачем нужно:** Профессиональные трейдеры хотят купить дешевле VWAP и продать дороже VWAP.

### 8. Где произошли сделки (поля 41-46) - Очень интересно!

Эти поля показывают, КТО победил: покупатели или продавцы.

```python
TradeAtBid = 5000      # 5,000 акций куплено по цене bid (продавцы уступили)
TradeAtAsk = 3000      # 3,000 акций куплено по цене ask (покупатели уступили)
TradeAtMid = 2000      # 2,000 акций - компромисс посередине
```

**Визуализация:**

```
ПРОДАВЦЫ ПОБЕДИЛИ          КОМПРОМИСС           ПОКУПАТЕЛИ ПОБЕДИЛИ
    (давление продаж)      (равновесие)         (давление покупок)
         ↓                      ↓                        ↓
    ████████              ████████                  ████████
    TradeAtBid            TradeAtMid                TradeAtAsk
    5,000 акций           2,000 акций               3,000 акций
```

**Интерпретация:**
- Больше `TradeAtBid` → Продавцы агрессивнее → Возможно падение цены
- Больше `TradeAtAsk` → Покупатели агрессивнее → Возможно рост цены

### 9. Объем и количество сделок (поля 47-48)

```python
Volume = 10000           # Всего проторговано 10,000 акций
TotalTrades = 150        # За минуту произошло 150 сделок
```

**Средний размер сделки:** 10,000 / 150 = 67 акций

**Что это говорит:**
- Много мелких сделок → Розничные инвесторы (обычные люди)
- Мало крупных сделок → Институционалы (фонды, банки)

### 10. FinraVolume (поле 49) - Темные пулы

```python
Volume = 10000           # Общий объем
FinraVolume = 3000       # Из них 3,000 в темных пулах
```

**Простое объяснение:**
- **Обычная биржа:** Все видят ордера - как на базаре
- **Темный пул (Dark Pool):** Крупные игроки торгуют тайно - как VIP-зал

**Формула биржевого объема:**
```python
exchange_volume = Volume - FinraVolume
exchange_volume = 10000 - 3000 = 7000 акций
```

30% объема в темных пулах - это нормально для крупных акций.

### 11. Uptick/Downtick Volume (поля 50-51) - Направление давления

```python
UptickVolume = 6000      # 6,000 акций куплено дороже предыдущей сделки
DowntickVolume = 4000    # 4,000 акций куплено дешевле предыдущей сделки
```

**Аналогия:** Перетягивание каната
```
ПОКУПАТЕЛИ (Uptick)    vs    ПРОДАВЦЫ (Downtick)
    6,000 акций                  4,000 акций
       ↑↑↑                          ↓↓↓
    ПОБЕЖДАЮТ!
```

**Индикатор силы:**
```python
uptick_ratio = UptickVolume / (UptickVolume + DowntickVolume)
uptick_ratio = 6000 / 10000 = 0.60 = 60%
```

Больше 50% → Покупатели сильнее → Бычий сигнал

## Практический пример: Анализ одной минуты

Давайте разберем реальный минутный бар Apple:

```python
# Минута: 15 марта 2017, 10:30-10:31
data = {
    'Date': 20170315,
    'Ticker': 'AAPL',
    'TimeBarStart': 1030,

    # Открытие
    'OpenBidPrice': 139.50,
    'OpenAskPrice': 139.52,

    # Первая сделка
    'FirstTradeTime': 103005123,
    'FirstTradePrice': 139.51,
    'FirstTradeSize': 100,

    # Экстремумы
    'HighBidPrice': 139.55,
    'LowBidPrice': 139.48,

    # Закрытие
    'CloseBidPrice': 139.52,
    'CloseAskPrice': 139.54,

    # Объемы
    'Volume': 10000,
    'VolumeWeightPrice': 139.515,
    'TotalTrades': 150,

    # Распределение сделок
    'TradeAtBid': 3000,
    'TradeAtMid': 4000,
    'TradeAtAsk': 3000,

    # Направление
    'UptickVolume': 6000,
    'DowntickVolume': 4000,

    # Темные пулы
    'FinraVolume': 3000,

    # Спред
    'MinSpread': 0.01,
    'MaxSpread': 0.03
}
```

### Что мы можем узнать из этой минуты?

**1. Движение цены:**
```python
price_change = data['CloseBidPrice'] - data['OpenBidPrice']
price_change = 139.52 - 139.50 = +0.02$ (+2 цента)
```
Цена выросла!

**2. Волатильность (размах колебаний):**
```python
price_range = data['HighBidPrice'] - data['LowBidPrice']
price_range = 139.55 - 139.48 = 0.07$ (7 центов)
```
За минуту цена колебалась в диапазоне 7 центов.

**3. Ликвидность:**
```python
avg_spread = (data['MinSpread'] + data['MaxSpread']) / 2
avg_spread = (0.01 + 0.03) / 2 = 0.02$ (2 цента)
```
Маленький спред = отличная ликвидность!

**4. Давление покупателей vs продавцов:**
```python
buyer_pressure = data['UptickVolume'] / data['Volume']
buyer_pressure = 6000 / 10000 = 60%
```
Покупатели сильнее (60% vs 40%)

**5. Институциональная активность:**
```python
dark_pool_ratio = data['FinraVolume'] / data['Volume']
dark_pool_ratio = 3000 / 10000 = 30%
```
30% в темных пулах = присутствуют крупные игроки

**6. Средний размер сделки:**
```python
avg_trade_size = data['Volume'] / data['TotalTrades']
avg_trade_size = 10000 / 150 = 67 акций
```
Небольшой размер = в основном розничные инвесторы

## Код для анализа AlgoSeek данных

### 1. Загрузка и базовый анализ

```python
import pandas as pd
import numpy as np

# Загрузить CSV файл AlgoSeek
df = pd.read_csv('AAPL_2017-03-15.csv')

# Базовая информация
print(f"Всего минут в файле: {len(df)}")
print(f"Торговых часов: {len(df)/60:.1f}")
print(f"Общий объем за день: {df['Volume'].sum():,} акций")

# Средние показатели
print(f"\nСредний спред: ${df['MinSpread'].mean():.3f}")
print(f"Средний VWAP: ${df['VolumeWeightPrice'].mean():.2f}")
print(f"Сделок в минуту: {df['TotalTrades'].mean():.0f}")
```

### 2. Найти самые активные минуты

```python
# Топ-10 самых активных минут
top_active = df.nlargest(10, 'Volume')[['TimeBarStart', 'Volume', 'TotalTrades']]

print("Самые активные минуты:")
for idx, row in top_active.iterrows():
    time = f"{row['TimeBarStart']//100:02d}:{row['TimeBarStart']%100:02d}"
    print(f"{time}: {row['Volume']:,} акций в {row['TotalTrades']} сделках")
```

### 3. Анализ давления покупателей/продавцов

```python
# Создать индикатор давления
df['BuyPressure'] = (df['UptickVolume'] - df['DowntickVolume']) / df['Volume']
df['BuyPressure'] = df['BuyPressure'].fillna(0)  # если Volume = 0

# Когда покупатели были сильнее?
bullish_minutes = df[df['BuyPressure'] > 0.2]  # Более 20% преимущество
print(f"Бычьих минут: {len(bullish_minutes)} из {len(df)}")

# Когда продавцы были сильнее?
bearish_minutes = df[df['BuyPressure'] < -0.2]
print(f"Медвежьих минут: {len(bearish_minutes)} из {len(df)}")
```

### 4. Анализ спреда и ликвидности

```python
# Когда была лучшая ликвидность?
df['AvgSpread'] = (df['MinSpread'] + df['MaxSpread']) / 2

# Разделить день на периоды
df['Hour'] = df['TimeBarStart'] // 100

liquidity_by_hour = df.groupby('Hour')['AvgSpread'].mean()

print("Средний спред по часам:")
for hour, spread in liquidity_by_hour.items():
    print(f"{hour:02d}:00 - ${spread:.3f}")
```

### 5. Обнаружение институциональной активности

```python
# Высокая активность темных пулов
df['DarkPoolRatio'] = df['FinraVolume'] / df['Volume']
df['DarkPoolRatio'] = df['DarkPoolRatio'].fillna(0)

# Найти минуты с высокой активностью институционалов
institutional = df[df['DarkPoolRatio'] > 0.4]  # Более 40% в темных пулах

print(f"Минут с высокой институциональной активностью: {len(institutional)}")
print(f"Средняя цена в эти минуты: ${institutional['VolumeWeightPrice'].mean():.2f}")
```

### 6. Создание OHLC баров (Open-High-Low-Close)

```python
# AlgoSeek уже предоставляет OHLC, но для сделок:
df['Open'] = df['FirstTradePrice']
df['High'] = df['HighTradePrice']
df['Low'] = df['LowTradePrice']
df['Close'] = df['LastTradePrice']

# Для котировок (bid):
df['BidOpen'] = df['OpenBidPrice']
df['BidHigh'] = df['HighBidPrice']
df['BidLow'] = df['LowBidPrice']
df['BidClose'] = df['CloseBidPrice']

# Визуализация свечного графика
import matplotlib.pyplot as plt
from mpl_finance import candlestick_ohlc
import matplotlib.dates as mdates

# Подготовить данные для свечного графика
ohlc = df[['TimeBarStart', 'Open', 'High', 'Low', 'Close']].copy()
ohlc = ohlc.dropna()  # Убрать пустые значения

# Конвертировать время в datetime
ohlc['Time'] = pd.to_datetime(df['Date'].astype(str) + df['TimeBarStart'].astype(str).str.zfill(4),
                                format='%Y%m%d%H%M')
ohlc['TimeNum'] = mdates.date2num(ohlc['Time'])

# Нарисовать свечи
fig, ax = plt.subplots(figsize=(12, 6))
candlestick_ohlc(ax, ohlc[['TimeNum', 'Open', 'High', 'Low', 'Close']].values,
                 width=0.0003, colorup='green', colordown='red')
ax.xaxis.set_major_formatter(mdates.DateFormatter('%H:%M'))
plt.title('Минутные свечи AAPL')
plt.xlabel('Время')
plt.ylabel('Цена ($)')
plt.show()
```

## Типичные торговые стратегии на минутных данных

### Стратегия 1: VWAP Reversion (Возврат к VWAP)

**Идея:** Если цена сильно отклонилась от VWAP, она вернется обратно.

```python
# Вычислить отклонение от VWAP
df['VWAP_Dev'] = (df['LastTradePrice'] - df['VolumeWeightPrice']) / df['VolumeWeightPrice']

# Сигнал покупки: цена на 0.2% ниже VWAP
buy_signal = df['VWAP_Dev'] < -0.002

# Сигнал продажи: цена на 0.2% выше VWAP
sell_signal = df['VWAP_Dev'] > 0.002

print(f"Сигналов на покупку: {buy_signal.sum()}")
print(f"Сигналов на продажу: {sell_signal.sum()}")
```

### Стратегия 2: Order Flow Imbalance (Дисбаланс потока ордеров)

**Идея:** Следовать за давлением покупателей/продавцов.

```python
# Индикатор дисбаланса
df['OrderImbalance'] = (df['TradeAtAsk'] - df['TradeAtBid']) / df['Volume']
df['OrderImbalance'] = df['OrderImbalance'].fillna(0)

# Сильный дисбаланс в сторону покупок
strong_buy = df['OrderImbalance'] > 0.3  # 30% преимущество покупателей

# Сильный дисбаланс в сторону продаж
strong_sell = df['OrderImbalance'] < -0.3

print(f"Сильных бычьих сигналов: {strong_buy.sum()}")
print(f"Сильных медвежьих сигналов: {strong_sell.sum()}")
```

### Стратегия 3: Spread Widening (Расширение спреда)

**Идея:** Когда спред расширяется, возможна повышенная волатильность.

```python
# Средний спред за последние 5 минут
df['SpreadMA5'] = df['AvgSpread'].rolling(5).mean()

# Спред расширился в 2 раза
spread_widening = df['AvgSpread'] > 2 * df['SpreadMA5']

print(f"Моментов расширения спреда: {spread_widening.sum()}")

# Что происходит после расширения спреда?
after_widening = df[spread_widening].shift(-1)  # Следующая минута
avg_volatility = (after_widening['HighTradePrice'] - after_widening['LowTradePrice']).mean()
print(f"Средняя волатильность после расширения: ${avg_volatility:.3f}")
```

## Важные замечания и FAQ

### Q: Зачем так много полей (54 штуки)?

**A:** Разные типы трейдеров используют разные данные:
- **Market makers** (маркетмейкеры): смотрят на спред и объемы на bid/ask
- **Momentum traders**: интересуются uptick/downtick volume
- **Institutional traders**: анализируют FINRA volume (темные пулы)
- **Arbitrage traders**: нужны точные тайминги (наносекунды)

### Q: Что важнее: котировки (Q) или сделки (T)?

**A:** Зависит от стратегии:
- **Котировки (Q):** Показывают намерения участников рынка ("что хотят")
- **Сделки (T):** Показывают реальность ("что произошло")

**Пример:**
```
10:30:00 - OpenBidPrice = $100, OpenAskPrice = $101
10:30:30 - FirstTradePrice = $100.50
```

Котировки сказали "от $100 до $101", но реальная сделка прошла посередине.

### Q: Почему сделки бывают пустыми (Blank)?

**A:** Не каждую минуту есть сделки!

Пример: Малоликвидная акция
```
10:30 - Volume = 0, FirstTradePrice = Blank (нет сделок)
10:31 - Volume = 100, FirstTradePrice = $50.25
10:32 - Volume = 0, FirstTradePrice = Blank (опять нет сделок)
10:33 - Volume = 500, FirstTradePrice = $50.30
```

Для Apple такого почти не бывает, но для маленьких компаний - нормально.

### Q: Как использовать TradeAtCrossOrLocked?

**A:** Это аномальная ситуация!

**Locked market:** Bid = Ask (спред = 0)
```
Bid: $100.00, Ask: $100.00
Спред = 0 - рынок "заблокирован"
```

**Crossed market:** Bid > Ask (невозможная ситуация!)
```
Bid: $100.05, Ask: $100.00
Кто-то готов купить дороже, чем продать!
```

Обычно это длится доли секунды - арбитражники моментально это исправляют.

## Системные требования

**Минимум:**
- 16 ГБ RAM
- 50 ГБ свободного места на диске
- Python 3.7+

**Рекомендуется:**
- 32-64 ГБ RAM (для анализа нескольких месяцев)
- SSD диск (быстрая загрузка)
- Многоядерный процессор для параллельной обработки

**Размер данных:**
- 1 день NASDAQ 100: ~5 ГБ
- 1 месяц: ~100 ГБ
- 1 год: ~1.2 ТБ

## Заключение

Минутные бары AlgoSeek - это невероятно подробные данные о том, что происходит на бирже. 54 поля дают полную картину:

✅ **Котировки** - что люди хотят
✅ **Сделки** - что реально произошло
✅ **Объемы** - насколько активно торгуют
✅ **Спред** - насколько легко купить/продать
✅ **Направление** - кто сильнее (покупатели или продавцы)
✅ **Темные пулы** - что делают крупные игроки

Это профессиональные данные, которые используют хедж-фонды и торговые фирмы. С их помощью можно строить очень точные торговые стратегии!

**Следующий шаг:** Открой ноутбук [algoseek_minute_data.ipynb](1_algoseek_minute_data.ipynb) и попробуй сам проанализировать данные!
