# Как обрабатывать внутридневные данные AlgoSeek NASDAQ 100

Вы можете скачать образец минутных баров NASDAQ100 от Algoseek с информацией о сделках и котировках за 2015-2017 с веб-сайта Algoseek [здесь](https://www.algoseek.com/ml4t-book-data.html). Ноутбук [algoseek_minute_data](1_algoseek_minute_data.ipynb) содержит код для извлечения и объединения данных, которые мы будем использовать в [Главе 12](../../12_gradient_boosting_machines) для разработки модели градиентного бустинга, которая предсказывает одноминутную доходность для внутридневной торговой стратегии.

Распакуйте директорию, переименуйте её в `1min_taq` и переместите в новую папку `nasdaq100` в директории [data](../../data). Она содержит около 5 ГБ данных минутных баров NASDAQ 100 в формате trade-and-quote. См. [документацию](https://us-equity-market-data-docs.s3.amazonaws.com/algoseek.US.Equity.TAQ.Minute.Bars.pdf) для получения подробной информации об определении многочисленных полей.

Следующая информация взята из данных минутных баров Trade & Quote от Algoseek, ссылка выше.

## Поля минутных баров Trade & Quote

Поля котировок основаны на изменениях NBBO ([National Best Bid Offer](https://www.investopedia.com/terms/n/nbbo.asp)) из цены и размера верхнего уровня книги от каждой из бирж.

Расширенные поля баров Trade & Quote включают следующие поля:
- **Field**: Название поля.
- **Q / T**: Поле основано на котировках (Quotes) или сделках (Trades)
- **Type**: Формат поля
- **No Value**: Значение поля, когда нет значения или данных.
  - Примечание: "Never" означает, что поле всегда должно иметь значение, КРОМЕ первого бара дня.
- **Description**: Описание поля.

| id  | Поле                    | Q/T  | Тип                           |  Нет значения | Описание                                                                                                                                                                                                         |
|:---:|-------------------------|:----:|-------------------------------|:-------------:|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1  | `Date`                   |      | YYYYMMDD                      | Never         | Дата торгов                                                                                                                                                                                                      |
| 2  | `Ticker`                 |      | String                        | Never         | Тикер символ                                                                                                                                                                                                     |
| 3  | `TimeBarStart`           |      | HHMM <br>HHMMSS <br>HHMMSSMMM | Never         | Для минутных баров: HHMM. <br>Для секундных баров: HHMMSS. <br>Примеры<br>- Одна секунда бар 130302 от времени больше 130301 до 130302.<br>- Одна минута бар 1104 от времени больше 1103 до 1104.         |
| 4  | `OpenBarTime`            | Q    | HHMMSSMMM                     | Never         | Время открытия бара, например одна минута:<br>11:03:00.000                                                                                                                                                      |
| 5  | `OpenBidPrice`           | Q    | Number                        | Never         | Цена NBBO Bid на момент открытия бара                                                                                                                                                                           |
| 6  | `OpenBidSize`            | Q    | Number                        | Never         | Общий размер со всех бирж с<br>OpenBidPrice                                                                                                                                                                      |
| 7  | `OpenAskPrice`           | Q    | Number                        | Never         | Цена NBBO Ask на момент открытия бара                                                                                                                                                                           |
| 8  | `OpenAskSize`            | Q    | Number                        | Never         | Общий размер со всех бирж с<br>OpenAskPrice                                                                                                                                                                      |
| 9  | `FirstTradeTime`         | T    | HHMMSSMMM                     | Blank         | Время первой сделки                                                                                                                                                                                              |
| 10 | `FirstTradePrice`        | T    | Number                        | Blank         | Цена первой сделки                                                                                                                                                                                               |
| 11 | `FirstTradeSize`         | T    | Number                        | Blank         | Количество акций первой сделки                                                                                                                                                                                   |
| 12 | `HighBidTime`            | Q    | HHMMSSMMM                     | Never         | Время наивысшей цены NBBO Bid                                                                                                                                                                                    |
| 13 | `HighBidPrice`           | Q    | Number                        | Never         | Наивысшая цена NBBO Bid                                                                                                                                                                                          |
| 14 | `HighBidSize`            | Q    | Number                        | Never         | Общий размер со всех бирж с HighBidPrice                                                                                                                                                                         |
| 15 | `AskPriceAtHighBidPrice` | Q    | Number                        | Never         | Цена Ask во время наивысшей цены Bid                                                                                                                                                                             |
| 16 | `AskSizeAtHighBidPrice`  | Q    | Number                        | Never         | Общий размер со всех бирж с `AskPriceAtHighBidPrice`                                                                                                                                                             |
| 17 | `HighTradeTime`          | T    | HHMMSSMMM                     | Blank         | Время наивысшей сделки                                                                                                                                                                                           |
| 18 | `HighTradePrice`         | T    | Number                        | Blank         | Цена наивысшей сделки                                                                                                                                                                                            |
| 19 | `HighTradeSize`          | T    | Number                        | Blank         | Количество акций наивысшей сделки                                                                                                                                                                                |
| 20 | `LowBidTime`             | Q    | HHMMSSMMM                     | Never         | Время наименьшего Bid                                                                                                                                                                                            |
| 21 | `LowBidPrice`            | Q    | Number                        | Never         | Наименьшая цена NBBO Bid бара                                                                                                                                                                                    |
| 22 | `LowBidSize`             | Q    | Number                        | Never         | Общий размер со всех бирж с `LowBidPrice`                                                                                                                                                                        |
| 23 | `AskPriceAtLowBidPrice`  | Q    | Number                        | Never         | Цена Ask при наименьшей цене Bid                                                                                                                                                                                 |
| 24 | `AskSizeAtLowBidPrice`   | Q    | Number                        | Never         | Общий размер со всех бирж с `AskPriceAtLowBidPrice`                                                                                                                                                              |
| 25 | `LowTradeTime`           | T    | HHMMSSMMM                     | Blank         | Время наименьшей сделки                                                                                                                                                                                          |
| 26 | `LowTradePrice`          | T    | Number                        | Blank         | Цена наименьшей сделки                                                                                                                                                                                           |
| 27 | `LowTradeSize`           | T    | Number                        | Blank         | Количество акций наименьшей сделки                                                                                                                                                                               |
| 28 | `CloseBarTime`           | Q    | HHMMSSMMM                     | Never         | Время закрытия бара, например одна минута: 11:03:59.999                                                                                                                                                          |
| 29 | `CloseBidPrice`          | Q    | Number                        | Never         | Цена NBBO Bid на момент закрытия бара                                                                                                                                                                            |
| 30 | `CloseBidSize`           | Q    | Number                        | Never         | Общий размер со всех бирж с `CloseBidPrice`                                                                                                                                                                      |
| 31 | `CloseAskPrice`          | Q    | Number                        | Never         | Цена NBBO Ask на момент закрытия бара                                                                                                                                                                            |
| 32 | `CloseAskSize`           | Q    | Number                        | Never         | Общий размер со всех бирж с `CloseAskPrice`                                                                                                                                                                      |
| 33 | `LastTradeTime`          | T    | HHMMSSMMM                     | Blank         | Время последней сделки                                                                                                                                                                                           |
| 34 | `LastTradePrice`         | T    | Number                        | Blank         | Цена последней сделки                                                                                                                                                                                            |
| 35 | `LastTradeSize`          | T    | Number                        | Blank         | Количество акций последней сделки                                                                                                                                                                                |
| 36 | `MinSpread`              | Q    | Number                        | Never         | Минимальный спред Bid-Ask. Может быть 0, если рынок был скрещен во время бара.<br/>Если отрицательный спред из-за обратной котировки, делаем его 0.                                                            |
| 37 | `MaxSpread`              | Q    | Number                        | Never         | Максимальный спред Bid-Ask в баре                                                                                                                                                                                |
| 38 | `CancelSize`             | T    | Number                        | 0             | Общее количество отмененных акций. По умолчанию=blank                                                                                                                                                            |
| 39 | `VolumeWeightPrice`      | T    | Number                        | Blank         | Средневзвешенная по объему цена сделок <br>Sum((`Trade1Shares`*`Price`)+(`Trade2Shares`*`Price`)+…)/`TotalShares`. <br>Примечание: Blank, если нет сделок.                                                     |
| 40 | `NBBOQuoteCount`         | Q    | Number                        | 0             | Количество котировок Bid и Ask NNBO во время периода бара.                                                                                                                                                       |
| 41 | `TradeAtBid`             | Q,T  | Number                        | 0             | Сумма объема торгов, которая произошла на уровне или ниже bid (сделка, сообщенная/напечатанная с опозданием, может быть ниже текущего bid).                                                                    |
| 42 | `TradeAtBidMid`          | Q,T  | Number                        | 0             | Сумма объема торгов между bid и серединой:<br/>(Trade Price > NBBO Bid ) & (Trade Price < NBBO Mid )                                                                                                            |
| 43 | `TradeAtMid`             | Q,T  | Number                        | 0             | Сумма объема торгов на середине.<br/>TradePrice = NBBO MidPoint                                                                                                                                                 |
| 44 | `TradeAtMidAsk`          | Q,T  | Number                        | 0             | Сумма объема ask между серединой и ask:<br/>(Trade Price > NBBO Mid) & (Trade Price < NBBO Ask)                                                                                                                 |
| 45 | `TradeAtAsk`             | Q,T  | Number                        | 0             | Сумма объема торгов на уровне или выше Ask.                                                                                                                                                                      |
| 46 | `TradeAtCrossOrLocked`   | Q,T  | Number                        | 0             | Сумма объема торгов для бара, когда национальное лучшее bid/offer заблокировано или скрещено. <br>Locked — Bid = Ask <br>Crossed — Bid > Ask                                                                   |
| 47 | `Volume`                 | T    | Number                        | 0             | Общее количество проторгованных акций                                                                                                                                                                            |
| 48 | `TotalTrades`            | T    | Number                        | 0             | Общее количество сделок                                                                                                                                                                                          |
| 49 | `FinraVolume`            | T    | Number                        | 0             | Количество акций, о которых сообщает FINRA. <br/>Сделки, сообщаемые FINRA, — от интернализации брокер-дилеров, темных пулов, Over-The-Counter и т. д.<br/>Сделки FINRA представляют объем, скрытый или недоступный для публичной торговли. |
| 50 | `UptickVolume`           | T    | Integer                       | 0             | Общее количество акций, проторгованных с повышением во время бара.<br/>Повышение = ( цена сделки > последняя цена сделки )                                                                                      |
| 51 | `DowntickVolume`         | T    | Integer                       | 0             | Общее количество акций, проторгованных с понижением во время бара.<br/>Понижение = ( цена сделки < последняя цена сделки )                                                                                      |
| 52 | `RepeatUptickVolume`     | T    | Integer                       | 0             | Общее количество акций, где цена сделки одинаковая (повторяющаяся) и последнее изменение цены было вверх во время бара. <br/>Repeat uptick = ( цена сделки == последняя цена сделки ) & (последнее направление тика == вверх ) |
| 53 | `RepeatDowntickVolume`   | T    | Integer                       | 0             | Общее количество акций, где цена сделки одинаковая (повторяющаяся) и последнее изменение цены было вниз во время бара. <br/>Repeat downtick = ( цена сделки == последняя цена сделки ) & (последнее направление тика == вниз ) |
| 54 | `UnknownVolume`          | T    | Integer                       | 0             | Когда происходит первая сделка дня, направление тика "неизвестно", так как нет предыдущей сделки для сравнения.<br/>Это поле — объем первой сделки после 4 утра и действует как начальное значение для направлений объема тика.<br/>В будущем этот бар будет переименован в `UnkownTickDirectionVolume` . |

### Примечания

**Пустые поля**

Пустое поле не имеет значения и является "Blank", например FirstTradeTime, и во время периода бара нет сделок.
Поле `Volume`, измеряющее общее количество проторгованных акций в баре, будет `0`, если нет сделок (см. столбец `No Value` выше для каждого поля).

**Нет Bid/Ask/Trade OHLC**

Во время временного интервала бара может не быть изменения в NBBO или фактической сделки.
Например, может быть бар с OHLC Bid/Ask, но без Trade OHLC.

**Одиночное событие**

Для баров только с одной сделкой, одним NBBO bid или одним NBBO ask цена, размер и время Open/High/Low/Close будут одинаковыми.

**Поля `AskPriceAtHighBidPrice`, `AskSizeAtHighBidPrice`, `AskPriceAtLowBidPrice`, `AskSizeAtLowBidPrice`**

Для обеспечения согласованных цен Bid/Ask в определенный момент времени при показе низкого/высокого Bid/Ask для бара, AlgoSeek использует низкий/высокий `Bid` и соответствующий `Ask` по этой цене.

## FAQ

**Почему цены сделок часто находятся внутри диапазона от цены Bid до цены Ask?**

Low/High Bid/Ask — это низкая и высокая цена NBBO для диапазона бара.
Очень часто сделка может не произойти по этим ценам, так как цена может длиться всего несколько секунд, или исполнения скрещиваются на середине из-за скрытых типов ордеров, которые исполняются на середине или как улучшение цены по сравнению с текущими `Bid`/`Ask`.

**Как получить биржевые торгуемые акции?**

Чтобы получить объем, торгуемый на бирже, в баре, вычтите `FinraVolume` из `Volume`.
- `Volume` — общее количество проторгованных акций.
- `FinraVolume` — общее количество акций, о которых сообщается как об исполнениях FINRA.

Когда сделка совершается вне листинговых бирж, о ней должна сообщить в FINRA брокерская фирма или темный пул. Примеры включают:
- внутренние кроссы брокер-дилером
- внебиржевые блочные сделки, и
- исполнения в темных пулах.
