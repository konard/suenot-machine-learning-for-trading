# Как компьютер учится торговать на бирже (простым языком)

## Что мы тут делаем?

Представь, что ты хочешь научить робота играть в игру "Угадай, вырастет цена или упадёт". Эта глава — инструкция, как проверить, хорошо ли робот научился играть, прежде чем давать ему настоящие деньги.

## Главная идея

**Бэктест** — это как репетиция перед концертом. Музыкант сначала много раз репетирует дома, прежде чем выступить на сцене. Мы тоже сначала "репетируем" нашу торговую стратегию на старых данных, прежде чем использовать её с реальными деньгами.

---

## Как устроен весь процесс (по шагам)

Представь, что ты открываешь киоск с лимонадом и хочешь понять, когда лучше продавать:

1. **Собираем данные** — Записываем погоду, день недели, сколько людей прошло мимо, сколько стаканов продали
2. **Ищем закономерности** — Замечаем: "В жаркие дни покупают больше!"
3. **Учим робота** — Показываем компьютеру эти закономерности
4. **Робот даёт советы** — "Завтра будет жарко — приготовь больше лимонада!"
5. **Проверяем на прошлом** — Смотрим: "А если бы мы слушали робота месяц назад — заработали бы больше?"

На бирже всё то же самое, только вместо лимонада — акции компаний!

---

## Ловушки, в которые легко попасть

### Ловушка 1: Заглядывание в будущее (Look-ahead bias)

**Пример из жизни:** Это как если бы ты играл в "Угадай число" и случайно подглядел ответ. Конечно, ты "угадаешь", но это нечестно!

**Как это бывает:** Допустим, мы учим робота предсказывать цену акции на понедельник. Но случайно показали ему данные за вторник. Робот "угадывает", но только потому, что он знает будущее!

**Как избежать:** Всегда проверяй, что робот видит только то, что было известно на момент прогноза.

---

### Ловушка 2: Ошибка выжившего (Survivorship bias)

**Пример из жизни:** Представь, что ты изучаешь "секрет успеха" только успешных бизнесменов. А про тех, кто разорился с теми же идеями, ты не знаешь. Вывод будет неправильный!

**На бирже:** Если мы учим робота только на акциях компаний, которые сейчас существуют — мы не видим компании, которые обанкротились. А это важно! Может, робот бы их купил и потерял деньги.

**Аналогия:** Это как изучать только самолёты, которые вернулись с войны, и не знать, куда попадали пули в те, что не вернулись.

---

### Ловушка 3: Случайное везение (Переобучение)

**Пример из жизни:** Представь, что ты подбрасываешь монетку 10 раз и случайно выпало 8 орлов. Ты решил: "Эта монетка волшебная!" Но на самом деле тебе просто повезло.

**На бирже:** Мы пробуем 100 разных стратегий. Одна показала отличный результат! Но может это просто случайность, как с монеткой?

**Коэффициент Шарпа (Sharpe Ratio):** Это как "детектор везения". Он помогает понять — стратегия реально хорошая или нам просто повезло?

---

## Два способа проверить стратегию

### Способ 1: Быстрый (Векторизованный)

**Аналогия:** Это как посчитать на калькуляторе: "Если бы я каждый день покупал мороженое за 50 рублей и продавал за 60 — сколько бы заработал за месяц?"

Быстро, просто, но не учитывает много важного (например, что мороженое не всегда есть в наличии).

### Способ 2: Подробный (Событийно-управляемый)

**Аналогия:** Это как играть в полноценную игру-симулятор магазина: каждый день открываешь магазин, к тебе приходят покупатели, ты делаешь выбор, считаешь выручку...

Дольше, сложнее, но гораздо реалистичнее!

---

## Инструменты для проверки

### Backtrader — твоя домашняя лаборатория

**Аналогия:** Это как конструктор LEGO для трейдинга. Ты собираешь свою стратегию из готовых кубиков:

- **Cerebro (мозг)** — главный блок, который всем управляет
- **Data (данные)** — исторические цены, как дневник продаж
- **Strategy (стратегия)** — твои правила "когда покупать, когда продавать"
- **Broker (брокер)** — виртуальный банк, который исполняет сделки

Можно тренироваться дома на своём компьютере!

### Zipline — профессиональная система

**Аналогия:** Если Backtrader — это домашняя кухня, то Zipline — это ресторан с профессиональным оборудованием. Его создали в настоящем инвестиционном фонде Quantopian.

Главное преимущество: он очень строго следит за тем, чтобы ты не "подглядывал в будущее".

---

## Простой пример: как это работает

Представим, что наш робот научился предсказывать погоду... то есть цены акций:

```
День 1: Робот говорит "Цена вырастет!" → Покупаем
День 2: Цена выросла на 2% → Ура, заработали!
День 3: Робот говорит "Цена упадёт!" → Продаём
День 4: Цена упала на 1% → Молодец, мы не потеряли!
```

Бэктест показывает: "Если бы ты слушал робота 100 дней, ты бы заработал 15%".

Но это ещё не значит, что нужно бежать торговать! Надо проверить:
- Не подглядывал ли робот в будущее?
- Учли ли мы комиссии брокера?
- Может, нам просто повезло?

---

## Главные уроки этой главы

1. **Сначала репетируй** — Никогда не торгуй реальными деньгами без проверки на истории

2. **Честная игра** — Следи, чтобы робот не знал будущего при обучении

3. **Помни о невезучих** — Учитывай компании, которые разорились

4. **Не верь в удачу** — Проверяй, не случайный ли твой успех

5. **Детали важны** — Комиссии, время исполнения сделок — всё это съедает прибыль

---

## Итог

Бэктестирование — это как лётный симулятор для пилотов. Сначала ты много-много раз "летаешь" на компьютере, делаешь ошибки, учишься. И только потом садишься в настоящий самолёт.

На бирже точно так же: сначала проверь свою стратегию на исторических данных миллион раз, найди все ошибки. И только потом — с маленькой суммой! — пробуй в реальности.

**Помни:** Даже лучшие стратегии иногда проигрывают. Это нормально. Главное — чтобы в среднем ты выигрывал чаще, чем проигрывал!
