# Глава 80: Проверка комплаенса с помощью LLM

## Обзор

Проверка комплаенса с помощью LLM представляет собой критически важное достижение в алгоритмической торговле, где большие языковые модели (LLM) автоматически проверяют соответствие торговых стратегий, ордеров и рыночной активности нормативным требованиям, внутренним политикам управления рисками и этическим принципам. Вместо того чтобы полагаться исключительно на системы на основе правил с жёстко закодированной логикой, LLM могут понимать контекст, интерпретировать сложные регуляции и адаптироваться к изменяющимся требованиям комплаенса.

В этой главе рассматривается создание системы проверки комплаенса на основе LLM, которая может анализировать торговые стратегии как на традиционных фондовых рынках, так и при торговле криптовалютами на платформах типа Bybit.

## Содержание

1. [Введение](#введение)
2. [Теоретические основы](#теоретические-основы)
3. [Регуляторная среда](#регуляторная-среда)
4. [Архитектура комплаенса на основе LLM](#архитектура-комплаенса-на-основе-llm)
5. [Категории проверок комплаенса](#категории-проверок-комплаенса)
6. [Архитектура системы](#архитектура-системы)
7. [Стратегия реализации](#стратегия-реализации)
8. [Комплаенс криптовалют](#комплаенс-криптовалют)
9. [Оценка рисков](#оценка-рисков)
10. [Примеры кода](#примеры-кода)
11. [Ссылки](#ссылки)

---

## Введение

### Что такое проверка комплаенса с помощью LLM?

Система проверки комплаенса с помощью LLM использует большие языковые модели для автоматической проверки соответствия торговой деятельности нормативным требованиям:

```
┌─────────────────────────────────────────────────────────────────────────┐
│              Обзор проверки комплаенса с помощью LLM                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│   Традиционный комплаенс:           Комплаенс на основе LLM:            │
│   ┌──────────────────┐              ┌──────────────────┐                │
│   │ Проверки на      │              │ Контекстно-      │                │
│   │ основе правил    │              │ зависимый анализ │                │
│   │      ↓           │              │ LLM              │                │
│   │ Бинарный         │              │      ↓           │                │
│   │ результат        │              │ Нюансированная   │                │
│   │      ↓           │              │ оценка           │                │
│   │ Требуется        │              │      ↓           │                │
│   │ ручная проверка  │              │ Объяснимые       │                │
│   │ (часы/дни)       │              │ рекомендации     │                │
│   └──────────────────┘              │ (секунды)        │                │
│                                     └──────────────────┘                │
│                                                                          │
│   Ключевые возможности:                                                 │
│   • Интерпретация сложных регуляторных текстов                         │
│   • Понимание контекста и намерений стратегии                          │
│   • Обнаружение тонких нарушений комплаенса                            │
│   • Адаптация к новым регуляциям без изменения кода                    │
│   • Генерация объяснимых отчётов о комплаенсе                          │
│   • Мультиюрисдикционная осведомлённость                               │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### Почему стоит использовать LLM для комплаенса?

| Аспект | Традиционный комплаенс | Комплаенс на основе LLM |
|--------|------------------------|-------------------------|
| Интерпретация правил | Жёсткая логика | Контекстное понимание |
| Новые регуляции | Требуются изменения кода | Достаточно обновления промптов |
| Граничные случаи | Часто пропускаются | Контекстное рассуждение |
| Объяснения | Общие коды ошибок | Отчёты на естественном языке |
| Мультиюрисдикция | Множество кодовых баз | Одна модель, разные контексты |
| Адаптивность | Медленная итерация | Быстрая корректировка |
| Аудиторский след | Структурированные логи | Человекочитаемые описания |

## Теоретические основы

### Фреймворк комплаенса

Комплаенс торговли может быть смоделирован как функция, отображающая торговую деятельность в результаты комплаенса:

$$C: \text{Торговая активность} \rightarrow \{Соответствует, Не соответствует, Требует проверки\}$$

LLM расширяет это, добавляя:
- **Оценки уверенности**: $P(Соответствует | Активность, Регуляции)$
- **Объяснения**: Обоснование на естественном языке
- **Рекомендации**: Предлагаемые шаги по исправлению

### Понимание регуляторного текста

LLM обрабатывают регуляторный текст через:

$$f_{LLM}: (R, A) \rightarrow (C, E, S)$$

Где:
- $R$ = Регуляторные требования (текст)
- $A$ = Проверяемая активность (детали сделки, описание стратегии)
- $C$ = Классификация комплаенса
- $E$ = Объяснение
- $S$ = Оценка серьёзности

```
┌─────────────────────────────────────────────────────────────────────────┐
│               Конвейер обработки комплаенса LLM                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ВХОД: Торговая активность + Регуляторный контекст                      │
│  ─────────────────────────────────────────────────────────────────────  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ {                                                                │   │
│  │   "activity_type": "order_submission",                          │   │
│  │   "symbol": "AAPL",                                             │   │
│  │   "quantity": 50000,                                            │   │
│  │   "order_type": "market",                                       │   │
│  │   "side": "buy",                                                │   │
│  │   "timestamp": "2024-01-15T09:30:00Z",                          │   │
│  │   "account_type": "proprietary",                                │   │
│  │   "jurisdiction": "US"                                          │   │
│  │ }                                                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              │                                          │
│                              ↓                                          │
│  ШАГ 1: ИЗВЛЕЧЕНИЕ РЕГУЛЯЦИЙ (RAG)                                     │
│  ─────────────────────────────────────────────────────────────────────  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ • Извлечение релевантных правил SEC                             │   │
│  │ • Получение правил FINRA                                        │   │
│  │ • Загрузка внутренних политик комплаенса                        │   │
│  │ • Включение последних регуляторных обновлений                   │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              │                                          │
│                              ↓                                          │
│  ШАГ 2: СБОРКА КОНТЕКСТА                                               │
│  ─────────────────────────────────────────────────────────────────────  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ • Исторические торговые паттерны для счёта                       │   │
│  │ • Текущие рыночные условия                                       │   │
│  │ • Лимиты позиций и пороговые значения                            │   │
│  │ • Ограничения и разрешения счёта                                 │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              │                                          │
│                              ↓                                          │
│  ШАГ 3: АНАЛИЗ LLM                                                     │
│  ─────────────────────────────────────────────────────────────────────  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ • Интерпретация регуляций относительно активности                │   │
│  │ • Выявление потенциальных нарушений                              │   │
│  │ • Оценка серьёзности и намерения                                 │   │
│  │ • Генерация рекомендаций по комплаенсу                           │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                              │                                          │
│                              ↓                                          │
│  ВЫХОД: Решение о комплаенсе                                           │
│  ─────────────────────────────────────────────────────────────────────  │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ {                                                                │   │
│  │   "status": "REVIEW_REQUIRED",                                  │   │
│  │   "confidence": 0.78,                                           │   │
│  │   "violations": [                                                │   │
│  │     {                                                            │   │
│  │       "rule": "SEC Rule 15c3-5",                                │   │
│  │       "description": "Крупный ордер требует предторговой        │   │
│  │                       проверки",                                 │   │
│  │       "severity": "MEDIUM"                                       │   │
│  │     }                                                            │   │
│  │   ],                                                             │   │
│  │   "explanation": "Этот рыночный ордер на 50,000 акций           │   │
│  │                   превышает...",                                 │   │
│  │   "recommendations": [                                           │   │
│  │     "Разделить ордер на меньшие транши",                        │   │
│  │     "Использовать TWAP алгоритм для снижения влияния на рынок"  │   │
│  │   ]                                                              │   │
│  │ }                                                                │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## Регуляторная среда

### Ключевые регуляторные фреймворки

```
┌─────────────────────────────────────────────────────────────────────────┐
│                    Глобальный регуляторный фреймворк                     │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  СОЕДИНЁННЫЕ ШТАТЫ                                                      │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ • SEC Rule 15c3-5 (Правило доступа к рынку)                     │   │
│  │   - Предторговые контроли рисков для брокер-дилеров             │   │
│  │   - Лимиты позиций и размера ордеров                            │   │
│  │                                                                  │   │
│  │ • Правила FINRA                                                  │   │
│  │   - Требования лучшего исполнения                                │   │
│  │   - Обязательства по пригодности                                 │   │
│  │   - Требования надзора                                           │   │
│  │                                                                  │   │
│  │ • Regulation SHO                                                 │   │
│  │   - Правила коротких продаж                                      │   │
│  │   - Требования по поиску заёмных бумаг                          │   │
│  │                                                                  │   │
│  │ • Закон Додда-Фрэнка                                             │   │
│  │   - Правило Волкера (ограничения проприетарной торговли)        │   │
│  │   - Регуляции своп-дилеров                                       │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  ЕВРОПЕЙСКИЙ СОЮЗ                                                       │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ • MiFID II / MiFIR                                               │   │
│  │   - Политики лучшего исполнения                                  │   │
│  │   - Отчётность о транзакциях                                     │   │
│  │   - Требования к алгоритмической торговле                       │   │
│  │                                                                  │   │
│  │ • MAR (Регулирование рыночных злоупотреблений)                   │   │
│  │   - Запрет инсайдерской торговли                                 │   │
│  │   - Обнаружение манипулирования рынком                           │   │
│  │                                                                  │   │
│  │ • EU AI Act (2025-2026)                                          │   │
│  │   - Требования прозрачности AI систем                            │   │
│  │   - Комплаенс высокорисковых AI систем                          │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
│  КРИПТОВАЛЮТЫ / ЦИФРОВЫЕ АКТИВЫ                                        │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │ • Требования AML/KYC                                             │   │
│  │   - Верификация клиентов                                         │   │
│  │   - Мониторинг транзакций                                        │   │
│  │                                                                  │   │
│  │ • Travel Rule (FATF)                                             │   │
│  │   - Обмен информацией между биржами                              │   │
│  │                                                                  │   │
│  │ • Правила конкретных бирж (Bybit, Binance и др.)                │   │
│  │   - Лимиты позиций                                               │   │
│  │   - Ограничения кредитного плеча                                 │   │
│  │   - Запрет фиктивной торговли                                    │   │
│  └─────────────────────────────────────────────────────────────────┘   │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### Хронология комплаенса 2025-2026

```
┌─────────────────────────────────────────────────────────────────────────┐
│                 Хронология регуляторного комплаенса                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  2025                                                                   │
│  ────                                                                   │
│  • Август 2025: EU AI Act - комплаенс моделей общего назначения AI     │
│  • FINRA продолжает фокус на рисках GenAI и новых технологий           │
│  • Применение поправок SEC Regulation S-P                               │
│                                                                          │
│  2026                                                                   │
│  ────                                                                   │
│  • Август 2026: EU AI Act - высокорисковые AI системы (кредитный       │
│    скоринг)                                                             │
│  • Отчёт FINRA 2026 подчёркивает кибербезопасность и управление AI     │
│  • Продолжение фокуса SEC на фидуциарных обязанностях и правилах       │
│    хранения                                                             │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## Архитектура комплаенса на основе LLM

### Компоненты системы

```rust
/// Основные компоненты системы проверки комплаенса
#[derive(Debug, Clone)]
pub struct ComplianceChecker {
    /// LLM клиент для анализа комплаенса
    pub llm_client: LlmClient,

    /// База данных регуляций с RAG извлечением
    pub regulation_db: RegulationDatabase,

    /// Движок оценки рисков
    pub risk_engine: RiskEngine,

    /// Конфигурация
    pub config: ComplianceConfig,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ComplianceConfig {
    /// Юрисдикции для проверки
    pub jurisdictions: Vec<Jurisdiction>,

    /// Уровень толерантности к риску
    pub risk_tolerance: RiskLevel,

    /// Порог уверенности для автоматического одобрения
    pub auto_approve_threshold: f64,

    /// Включить ли проверку в реальном времени
    pub real_time_enabled: bool,

    /// Уровень ведения аудиторского журнала
    pub audit_level: AuditLevel,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum Jurisdiction {
    UnitedStates,
    EuropeanUnion,
    UnitedKingdom,
    Singapore,
    HongKong,
    Global,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum RiskLevel {
    Conservative,  // Консервативный
    Moderate,      // Умеренный
    Aggressive,    // Агрессивный
}
```

### Структуры данных для проверки комплаенса

```rust
/// Торговая активность для проверки комплаенса
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct TradingActivity {
    /// Уникальный идентификатор
    pub id: String,

    /// Тип активности
    pub activity_type: ActivityType,

    /// Торговый символ
    pub symbol: String,

    /// Количество
    pub quantity: f64,

    /// Цена (если применимо)
    pub price: Option<f64>,

    /// Тип ордера
    pub order_type: Option<OrderType>,

    /// Сторона сделки
    pub side: TradeSide,

    /// Временная метка
    pub timestamp: DateTime<Utc>,

    /// Информация о счёте
    pub account: AccountInfo,

    /// Идентификатор стратегии
    pub strategy_id: Option<String>,

    /// Дополнительный контекст
    pub metadata: HashMap<String, String>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum ActivityType {
    OrderSubmission,     // Подача ордера
    OrderModification,   // Изменение ордера
    OrderCancellation,   // Отмена ордера
    TradeExecution,      // Исполнение сделки
    PositionChange,      // Изменение позиции
    FundsTransfer,       // Перевод средств
    StrategyDeployment,  // Развёртывание стратегии
}

/// Результат проверки комплаенса
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ComplianceResult {
    /// Проверенная активность
    pub activity_id: String,

    /// Общий статус
    pub status: ComplianceStatus,

    /// Оценка уверенности (от 0.0 до 1.0)
    pub confidence: f64,

    /// Список потенциальных нарушений
    pub violations: Vec<Violation>,

    /// Объяснение на естественном языке
    pub explanation: String,

    /// Рекомендуемые действия
    pub recommendations: Vec<String>,

    /// Проверенные регуляции
    pub regulations_checked: Vec<String>,

    /// Временная метка
    pub checked_at: DateTime<Utc>,

    /// Идентификатор аудиторского следа
    pub audit_id: String,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum ComplianceStatus {
    Approved,        // Одобрено
    Rejected,        // Отклонено
    ReviewRequired,  // Требуется проверка
    Pending,         // В ожидании
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct Violation {
    /// Нарушенное правило или регуляция
    pub rule: String,

    /// Описание нарушения
    pub description: String,

    /// Уровень серьёзности
    pub severity: ViolationSeverity,

    /// Подтверждающие доказательства
    pub evidence: Vec<String>,
}

#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum ViolationSeverity {
    Low,       // Низкий
    Medium,    // Средний
    High,      // Высокий
    Critical,  // Критический
}
```

## Категории проверок комплаенса

### Предторговый комплаенс

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   Предторговые проверки комплаенса                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  1. ЛИМИТЫ ПОЗИЦИЙ                                                      │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Проверка относительно регуляторных лимитов позиций          │  │
│     │ • Проверка ненарушения внутренних лимитов риска               │  │
│     │ • Расчёт риска концентрации                                    │  │
│     │ • Оценка экспозиции на уровне портфеля                        │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  2. ВАЛИДАЦИЯ РАЗМЕРА ОРДЕРА                                            │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Проверка непревышения лимитов на один ордер                 │  │
│     │ • Оценка потенциального влияния на рынок                      │  │
│     │ • Оценка достаточности ликвидности                            │  │
│     │ • Валидация лимитов номинальной стоимости                     │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  3. КОМПЛАЕНС КОРОТКИХ ПРОДАЖ                                           │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Проверка выполнения требования locate (Reg SHO)             │  │
│     │ • Проверка на ограниченные ценные бумаги                      │  │
│     │ • Валидация комплаенса правила uptick                         │  │
│     │ • Подтверждение доступности займа                             │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  4. ОГРАНИЧЕНИЯ СЧЁТА                                                   │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Проверка авторизации счёта для типа инструмента             │  │
│     │ • Проверка на торговые ограничения или заморозки              │  │
│     │ • Валидация маржинальных требований                           │  │
│     │ • Подтверждение разрешения типа счёта для стратегии           │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  5. КОМПЛАЕНС СТРАТЕГИИ                                                 │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Проверка одобрения стратегии для счёта                      │  │
│     │ • Проверка требований алготрейдинга (MiFID II)                │  │
│     │ • Валидация функциональности kill switch                      │  │
│     │ • Подтверждение границ параметров риска                       │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### Послеторговый комплаенс

```
┌─────────────────────────────────────────────────────────────────────────┐
│                   Послеторговые проверки комплаенса                      │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  1. АНАЛИЗ ЛУЧШЕГО ИСПОЛНЕНИЯ                                           │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Сравнение цены исполнения с бенчмарком (VWAP, arrival price)│  │
│     │ • Анализ рыночных условий в момент исполнения                 │  │
│     │ • Документирование метрик качества исполнения                 │  │
│     │ • Генерация отчётов о лучшем исполнении                       │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  2. ОТЧЁТНОСТЬ ПО ТРАНЗАКЦИЯМ                                           │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Проверка наличия всех обязательных полей                    │  │
│     │ • Проверка сроков отчётности                                   │  │
│     │ • Валидация информации о контрагенте                          │  │
│     │ • Обеспечение комплаенса регуляторной подачи                  │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  3. ОБНАРУЖЕНИЕ МАНИПУЛИРОВАНИЯ РЫНКОМ                                  │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Обнаружение потенциальных паттернов спуфинга                │  │
│     │ • Выявление активности лейеринга                              │  │
│     │ • Проверка на фиктивную торговлю                              │  │
│     │ • Анализ соотношения ордеров к сделкам                        │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  4. ГЕНЕРАЦИЯ АУДИТОРСКОГО СЛЕДА                                        │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Создание неизменяемых записей комплаенса                    │  │
│     │ • Хранение обоснования решений с объяснениями                 │  │
│     │ • Связывание с исходными регуляциями                          │  │
│     │ • Обеспечение поддержки регуляторных расследований            │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## Архитектура системы

### Высокоуровневая архитектура

```
┌─────────────────────────────────────────────────────────────────────────┐
│                Архитектура проверки комплаенса LLM                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│                       ┌─────────────────┐                               │
│                       │ Торговая система │                               │
│                       └────────┬────────┘                               │
│                                │                                         │
│                                ▼                                         │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    ШЛЮЗ КОМПЛАЕНСА                                 │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐               │  │
│  │  │ Предторговые│  │ Real-Time   │  │Послеторговой│               │  │
│  │  │ проверки    │  │ мониторинг  │  │ анализ      │               │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘               │  │
│  └────────────────────────────┬──────────────────────────────────────┘  │
│                               │                                          │
│                               ▼                                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                  ДВИЖОК КОМПЛАЕНСА LLM                            │  │
│  │                                                                    │  │
│  │  ┌─────────────────┐    ┌─────────────────┐    ┌──────────────┐  │  │
│  │  │ RAG регуляций   │ →  │ Анализ LLM      │ →  │ Движок       │  │  │
│  │  │ (Векторная БД)  │    │ (OpenAI/Claude) │    │ решений      │  │  │
│  │  └─────────────────┘    └─────────────────┘    └──────────────┘  │  │
│  │          ↑                      ↑                     ↓           │  │
│  │  ┌───────────────┐      ┌───────────────┐    ┌──────────────┐   │  │
│  │  │ Обновления    │      │ Сборщик       │    │ Генератор    │   │  │
│  │  │ регуляций     │      │ контекста     │    │ аудит-лога   │   │  │
│  │  └───────────────┘      └───────────────┘    └──────────────┘   │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  ┌───────────────────────────────────────────────────────────────────┐  │
│  │                    ХРАНИЛИЩА ДАННЫХ                                │  │
│  │                                                                    │  │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐               │  │
│  │  │ База данных │  │ База данных │  │ Аудиторские │               │  │
│  │  │ регуляций   │  │ позиций     │  │ логи        │               │  │
│  │  └─────────────┘  └─────────────┘  └─────────────┘               │  │
│  └───────────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## Комплаенс криптовалют

### Проверки комплаенса, специфичные для Bybit

```
┌─────────────────────────────────────────────────────────────────────────┐
│                 Проверки комплаенса криптовалют                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  1. ЛИМИТЫ КРЕДИТНОГО ПЛЕЧА                                             │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Проверка плеча в пределах лимитов платформы (макс. 100x)    │  │
│     │ • Проверка пользовательских ограничений плеча                 │  │
│     │ • Валидация маржинальных требований                           │  │
│     │ • Мониторинг риска ликвидации                                  │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  2. ЛИМИТЫ РАЗМЕРА ПОЗИЦИИ                                              │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Проверка лимитов позиций по контрактам                      │  │
│     │ • Проверка лимитов номинальной стоимости                      │  │
│     │ • Мониторинг вклада в открытый интерес                        │  │
│     │ • Валидация разрешений уровня счёта                           │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  3. ОБНАРУЖЕНИЕ ФИКТИВНОЙ ТОРГОВЛИ                                      │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Обнаружение самосводящихся ордеров                          │  │
│     │ • Выявление паттернов циклической торговли                    │  │
│     │ • Мониторинг создания искусственного объёма                   │  │
│     │ • Флаги подозрительных паттернов ордеров                      │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  4. КОМПЛАЕНС AML/KYC                                                   │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Проверка статуса KYC перед крупными сделками                │  │
│     │ • Проверка лимитов вывода по уровню верификации               │  │
│     │ • Мониторинг подозрительных паттернов транзакций              │  │
│     │ • Валидация комплаенса Travel Rule                            │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
│  5. ПРЕДОТВРАЩЕНИЕ МАНИПУЛИРОВАНИЯ РЫНКОМ                               │
│     ┌───────────────────────────────────────────────────────────────┐  │
│     │ • Обнаружение спуфинга и лейеринга                            │  │
│     │ • Выявление паттернов pump-and-dump                           │  │
│     │ • Мониторинг манипулирования стаканом ордеров                 │  │
│     │ • Проверка на координированную торговлю                       │  │
│     └───────────────────────────────────────────────────────────────┘  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## Оценка рисков

### LLM для оценки комплаенса на основе рисков

```
┌─────────────────────────────────────────────────────────────────────────┐
│              Оценка комплаенса на основе рисков                          │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  Матрица оценки рисков:                                                 │
│                                                                          │
│  ┌────────────────┬─────────────┬──────────────┬──────────────┐        │
│  │   Фактор       │   Низкий    │   Средний    │   Высокий    │        │
│  ├────────────────┼─────────────┼──────────────┼──────────────┤        │
│  │ Размер ордера  │ < $100K     │ $100K-$1M    │ > $1M        │        │
│  │ Влияние на рын.│ < 0.1%      │ 0.1%-1%      │ > 1%         │        │
│  │ Концентрация   │ < 5%        │ 5%-15%       │ > 15%        │        │
│  │ Плечо          │ < 5x        │ 5x-20x       │ > 20x        │        │
│  │ Возраст счёта  │ > 1 года    │ 3мес-1год    │ < 3 месяцев  │        │
│  │ Частота торгов.│ < 10/день   │ 10-100/день  │ > 100/день   │        │
│  └────────────────┴─────────────┴──────────────┴──────────────┘        │
│                                                                          │
│  Оценка рисков LLM:                                                     │
│  ───────────────────                                                    │
│  • Комбинирует количественные факторы риска                            │
│  • Включает качественный контекст (рыночные условия, новости)          │
│  • Учитывает исторические паттерны поведения                           │
│  • Адаптирует пороги на основе изменений регуляций                     │
│                                                                          │
│  Выход: Оценка риска (0-100) + Детальная разбивка                      │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

## Примеры кода

### Реализация на Python

Полная реализация на Python доступна в файле `examples/compliance_checker.py`, включая:

- Класс `LLMComplianceChecker` для анализа на основе LLM
- Класс `RuleBasedPreCheck` для быстрых предварительных проверок
- Класс `ComplianceCheckPipeline` для полного конвейера проверки
- Структуры данных для торговой активности и результатов комплаенса

### Реализация на Rust

Полная реализация на Rust доступна в директории `src/` со следующими модулями:

- `lib.rs` - Главная точка входа библиотеки
- `compliance/` - Основная логика проверки комплаенса
- `regulations/` - База данных регуляций и RAG
- `data/` - Структуры данных и получение данных
- `reports/` - Генерация отчётов

## Ссылки

### Научные работы

1. **LLMs for Regulatory Compliance in Finance**
   - URL: https://arxiv.org/abs/2402.01758
   - Год: 2024

2. **Responsible Innovation: A Strategic Framework for Financial LLM Integration**
   - URL: https://arxiv.org/pdf/2504.02165
   - Год: 2025

### Регуляторные ресурсы

1. **Отчёт FINRA о регуляторном надзоре 2026**
   - Источник: FINRA
   - Фокус: Риски GenAI, кибербезопасность, комплаенс Reg BI

2. **Приоритеты проверок SEC 2026**
   - Источник: SEC Division of Examinations
   - Фокус: Фидуциарные обязанности, правила хранения, кибербезопасность

3. **EU AI Act**
   - Вступает в силу: Август 2025 (общий AI), Август 2026 (высокорисковый)
   - Требования: Прозрачность, управление рисками, человеческий надзор

### Документация бирж

1. **Документация API Bybit** - https://bybit-exchange.github.io/docs/
2. **Документация API Binance** - https://binance-docs.github.io/apidocs/

---

## Резюме

Системы проверки комплаенса с помощью LLM представляют собой смену парадигмы в регуляторном комплаенсе для торговли:

1. **Контекстно-зависимый анализ**: LLM понимают регуляторные нюансы и торговый контекст
2. **Адаптивность**: Обновление правил комплаенса через промпты, а не изменения кода
3. **Объяснимость**: Генерация человекочитаемых отчётов о комплаенсе и аудиторских следов
4. **Мультиюрисдикционность**: Одна модель обрабатывает множество регуляторных фреймворков
5. **Работа в реальном времени**: Достаточно быстро для предторговых проверок комплаенса

Ключевые соображения при реализации:
- Комбинирование быстрых проверок на основе правил с глубоким анализом LLM
- Использование RAG для извлечения релевантных регуляций
- Ведение полных аудиторских следов
- Реализация порогов уверенности для автоматического одобрения vs. ручной проверки
- Регулярная валидация на соответствие обновлениям регуляций

Комбинация традиционных систем на основе правил с интеллектом LLM обеспечивает лучшее из обоих миров: скорость и интерпретируемость правил с адаптивностью и нюансированным пониманием LLM.
